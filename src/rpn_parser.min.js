function RPNParser(h,C){function r(c,b){p[c]={};p[c][b]=1}function w(c,t,d,g,a){t=Object.keys(p[t]);var e=a(g,g);b(c,d,e[0],1);for(var f=0;f<t.length;f++)t[f]!=g&&(e=a(g,t[f]),b(c,d,e[0],e[1]))}function b(c,d,f,g){if(f instanceof Array)for(var a=0;a<f.length;a++)b(c,d,f[a],g);else d=p[c][d],void 0!==d&&(p[c][f]="string"===typeof d||d instanceof String?d+g+" ":d*g)}function x(c,b,d){if(d instanceof Array)for(var g=0;g<d.length;g++)x(c,b,d[g]);else void 0!==p[c][b]&&(p[c][d]=p[c][b])}function v(c,d,
b,g){var a=p[c][b],e=p[c][g];if(void 0===a||void 0===e)return 0;if(("string"===typeof a||a instanceof String)&&("string"===typeof e||e instanceof String)){c=" ";a=a.split(" ");b="+ - / * ^ % mod".split(" ");g="-;+;*;/;1 swap / ^;%;mod".split(";");for(var f=0,k="",m=0;m<a.length;m++)if(0!=a[m].length){var q=b.indexOf(a[m]);-1===q?(f++,k+=a[m]+" "):(1==f?(c=k+g[q]+" "+c,k=""):k+=a[m]+" ",f--)}return d+" "+(k+c)+" "+e}return h.multiply(h.divide(d,p[c][b]),p[c][g])}function f(c){return 0==m.length?0:
(void 0===c?0:c)||!Array.isArray(u())?m.pop():m.pop()[0]}function A(){return 0==m.length?"":""+u()}function u(){return 0==m.length?0:m[m.length-1]}function d(c){Array.isArray(c)||(c=[c]);m.push(c)}function y(c){return B[c]}function D(c){-1!=(""+c).indexOf(".")?(c=(""+c).split("."),c[0]=parseInt(c[0]),c[1]=parseInt(c[1]),c=[c[1],h.pow(10,(""+c[1]).length),c[0]]):c=[0,1,c];var b=h.gcd(c[0],c[1]);return[c[1]/b*c[2]+c[0]/b,c[1]/b]}function q(c){c=c.split(" ");for(var b="+ - / * % ^ mod".split(" "),n=
0;n<c.length;n++){var g=c[n];if(0!=g.length)if(-1!=g.indexOf("..")){var a=parseInt(g.split("..")[0]),e=parseInt(g.split("..")[1]);isNaN(a)&&(a=parseInt(""+y(g.split("..")[0])));isNaN(e)&&(e=parseInt(""+y(g.split("..")[1])));isNaN(a)||isNaN(e)||(d([a,e]),q("seq"))}else if(37==g.charCodeAt(0)&&1!=g.length)a=A(),g=g.substring(1),B[g]=a;else if(36==g.charCodeAt(0)&&1!=g.length)q(y(g.substring(1)));else{a:{var l=g;if("!"==l)d(h.factorial(f(!0)));else if("rand"==l){a=f(!0);for(e=0;e<a.length;e++)a[e]=Math.floor(1E5*
Math.random()%a[e]);d(a)}else if("round"==l)d(h.round(f(!0)));else if("floor"==l)d(h.floor(f(!0)));else if("ceil"==l)d(h.ceil(f(!0)));else if("lcm"==l)d(h.lcm(f(!0),f(!0)));else if("gcd"==l)d(h.gcd(f(!0),f(!0)));else if("pyth"==l)2==u().length&&q("mag");else if("abs"==l)d(h.abs(f(!0)));else if("min"==l||"max"==l||"lcm2"==l||"gcd2"==l){var a=f(!0),e=a[0],k=h.min;switch(l){case "max":k=h.max;break;case "lcm2":k=h.lcm;break;case "gcd2":k=h.gcd}for(l=1;l<a.length;l++)e=k(e,a[l]);d(e)}else if("ln"==l)d(h.log(f(!0)));
else if("log"==l)d(h.log(f(!0))/h.log(10));else if("acc"==l)e=f(),a=f(!0),d(h.divide(h.round(h.multiply(a,h.pow(10,e))),h.pow(10,e)));else{a=!1;break a}a=!0}a||(a=g.split("|"),3==a.length&&void 0!==p[a[0]]&&void 0!==p[a[0]][a[1]]&&void 0!==p[a[0]][a[2]]?(a=v(a[0],f(!0),a[1],a[2]),"string"===typeof a||a instanceof String?q(a):d(a),a=!0):a=!1);if(!a)a:{a=g;if("K2"==a)d(89876E5);else if("K"==a)d(1/(3.5416E-11*Math.PI));else if("Uo"==a)d(4E-7*Math.PI);else if("ec"==a||"elec"==a)d(1.602E-19);else if("electronMass"==
a)d(9.10938356E-31);else if("protonMass"==a)d(1.6726E-27);else if("Eo"==a)d(8.854E-12);else if("error"==a)q("%perE del %perA del $perE $perA - $perA / 100 *");else{a=!1;break a}a=!0}if(!a){if(a=-1!=b.indexOf(g))a:{k=g;a=f(!0);e=f(!0);if(a.length!=e.length)if(1==e.length)l=a,a=e[0],e=l;else if(1==a.length)a=a[0];else{a=!1;break a}if("+"==k)d(h.add(e,a));else if("^"==k){a=a[0];for(k=0;k<e.length;k++)e[k]=Math.pow(e[k],a);d(e)}else if("-"==k)d(h.subtract(e,a));else if("/"==k)d(h.divide(e,a));else if("*"==
k)d(h.multiply(e,a));else if("%"==k||"mod"==k)d(h.mod(e,a));else{a=!1;break a}a=!0}if(!a){a:{a=g;if("asin"==a)d(h.asin(f(!0)));else if("acos"==a)d(h.acos(f(!0)));else if("asin"==a)d(h.acos(f(!0)));else if("dcos"==a)a=f(!0),a=h.cos(h.divide(h.multiply(a,Math.PI),180)),d(a);else if("dsin"==a)a=f(!0),a=h.sin(h.divide(h.multiply(a,Math.PI),180)),d(a);else if("dtan"==a)a=f(!0),a=h.tan(h.divide(h.multiply(a,Math.PI),180)),d(a);else if("rcos"==a)a=f(!0),a=h.cos(a),d(a);else if("rsin"==a)a=f(!0),a=h.sin(a),
d(a);else if("rtan"==a)a=f(!0),a=h.tan(a),d(a);else if("atan"==a)d(h.atan(f(!0)));else if("PI"==a)d(Math.PI);else if("e"==a||"E"==a)d(Math.E);else{a=!1;break a}a=!0}if(!(a=a||E(g)))a:{a=g;if("frac"==a||"fraction"==a){a=f(!0);e=[];for(k=0;k<a.length;k++)e=e.concat(D(a[k]));d(e)}else if("seq"==a)if(a=f(!0),2<=a.length){e=1;3==a.length&&(e=a[2]);l=[];if(a[0]<a[1])for(k=a[0];k<=a[1];k+=e)l.push(k);else for(k=a[0];k>=a[1];k-=e)l.push(k);d(l)}else{a=!1;break a}else if("combination"==a||"nCr"==a||"comb"==
a)a=f(!0),d(h.combinations(a[0],a[1]));else if("permutation"==a||"perm"==a||"nPr"==a)a=f(!0),d(h.permutations(a[0],a[1]));else if("multinomial"==a)a=f(!0),d(h.multinomial(a));else if("sigfig"==a||"sig"==a||"sig_fig"==a)a=f(!0),e=[0,1],a=a[0].toPrecision(a[1]).split("e"),1!=a.length&&(e[1]=parseFloat(a[1])),e[0]=parseFloat(a[0]),d(e);else{a=!1;break a}a=!0}if(!a)a:{a=g;for(e=0;e<z.length;e++)if(z[e](a)){a=!0;break a}a=!1}if(!a)if("pop"==g||"del"==g)f();else if("@size"==g)d(m.length);else if("dup"==
g)g=u(),g=JSON.parse(JSON.stringify(g)),d(g);else if("clear"==g)g=m,m=[],delete g;else if("swap"==g)g=m[m.length-1],m[m.length-1]=m[m.length-2],m[m.length-2]=g;else{a:if(a=g,-1!=a.indexOf(",")&&0!=a.indexOf(",")){a=a.split(",");e=[];for(k=0;k<a.length;k++)if(isNaN(parseFloat(a[k]))){a=!1;break a}else e.push(parseFloat(a[k]));d(e);a=!0}else a=!1;a||(isNaN(parseFloat(g))?C(g):d(parseFloat(g)))}}}}}}function E(c){if("dot"==c)return d(h.dot(f(!0),f(!0))),!0;if("cross"==c)return d(h.cross(f(!0),f(!0))),
!0;if("magnitude"==c||"mag"==c)return d(h.norm(f(!0))),!0;if("unitVector"==c)return q("dup mag /"),!0;if("dist"==c)return d(h.distance(f(!0),f(!0))),!0;if("vecGen"==c)return q("%vecd dup dcos swap dsin 2 vec *"),!0;if("at"==c){c=f();var b=f(!0);d(b[c]);return!0}if("vecAngle"==c)return q("dup mag / dup 0 at acos deg swap 1 at asin deg"),!0;if("directionCosines"==c)return q("unitVector acos"),!0;if("directionSines"==c)return q("unitVector asin"),!0;if("multVector"==c||"divVector"==c){for(var n=f(!0),
b=f(!0),g=Math.min(b.length,n.length),a=[],e=0;e<g;e++)"multVector"==c?a.push(b[e]*n[e]):a.push(b[e]/n[e]);d(a);return!0}if("sum"==c||"product"==c){b=f(!0);for(e=n=0;e<b.length;e++)"sum"==c?n+=b[e]:(0==e&&(n=1),n*=b[e]);d(n);return!0}if("merge"==c||"union"==c||","==c)return b=f(!0),n=f(!0),d(n.concat(b)),!0;if("sort"==c)return d(h.sort(f(!0))),!0;if("uniq"==c)return d(F(f(!0))),!0;if("reverse"==c)return d(f(!0).reverse()),!0;if("mean"==c)return d(h.mean(f(!0))),!0;if("median"==c)return d(h.median(f(!0))),
!0;if("mode"==c)return d(h.mode(f(!0))),!0;if("pick"==c)return d(h.pickRandom(f(!0))),!0;if("decompose"==c){b=f(!0);for(e=0;e<b.length;e++)d(b[e]);return!0}if("std"==c)return d(h.std(f(!0))),!0;if("intersection"==c){b=f(!0);n=f(!0);a=[];for(e=0;e<b.length;e++)-1!=n.indexOf(b[e])&&(a.push(b[e]),n.splice(n.indexOf(b[e]),1));d(a);return!0}if("diff"==c){n=f(!0);b=f(!0);for(e=0;e<n.length;e++)-1!=b.indexOf(n[e])&&b.splice(b.indexOf(n[e]),1);d(b);return!0}return"udiff"==c?(q("%b pop %a $b diff $b $a diff union"),
!0):!1}function F(b){var d={};return b.filter(function(b){return d.hasOwnProperty(b)?!1:d[b]=!0})}var p={},m=[],B={},z=[];(function(){function c(c,d,g){b(c,"kilo"+d,"k"+g,1);b(c,"centi"+d,"c"+g,1);b(c,"milli"+d,"m"+g,1);b(c,"nano"+d,"n"+g,1);b(c,"micro"+d,"u"+g,1);b(c,"pico"+d,"p"+g,1);b(c,"femto"+d,"f"+g,1)}(function(c,d){r("metric","none");for(var g=0;g<c.length;g++)b("metric","none",c[g],1/d[g]);b("metric","none","",1);b("metric","none","normal",1)})("exa peta tera giga mega kilo hecto deca deci centi milli micro nano pico femto atto".split(" "),
[1E18,1E15,1E12,1E9,1E6,1E3,100,10,.1,.01,.001,1E-6,1E-9,1E-12,1E-15,1E-18]);r("dist","m");b("dist","m","meter",1);w("dist","metric","m","",function(b,c){var d=v("metric",1,b,c);return[[c+"meter","meters"],d]});c("dist","meter","m");b("dist","cm",["in","inch","inches"],.3937);b("dist","in",["ft","feet"],1/12);b("dist","ft",["yd","yards"],1/3);b("dist","ft",["mi","mile","miles"],1/5280);b("dist","m",["nautical_mile","Nautical-Mile","Nautical_Mile","nautical-mile"],1/1852);r("angle","rad");b("angle",
"rad","deg",180/Math.PI);b("angle","rad","radian",1);b("angle","deg","degree",1);b("angle","degree","degrees",1);b("angle","radian","radians",1);r("volume","cup");b("volume","cup",["Cup","cups","Cups"],1);b("volume","cup",["tsp","teaspoon","Teaspoon","teaspoons","Teaspoons"],48);b("volume","cup",["tbsp","tablespoon","Tablespoon","tablespoons","Tablespoons"],16);b("volume","cup",["oz","floz","OZ"],8);b("volume","cup",["pint","Pint","pints","Pints"],.5);b("volume","pint",["quart","Quart","quarts","Quarts"],
.5);b("volume","quart","gallon Gallon gallons Gallons gal Gal".split(" "),.25);b("volume","gallon",["liter","Liter","L","l"],3.78541);b("volume","liter",["mL","ml"],1E3);b("volume","liter",["cubic_m","m^3","cubic_meter","cubic_meters"],.001);w("volume","dist","mL","cm",function(b,c){var d=v("dist",1,b,c),d=Math.pow(d,3);return[c+"^3",d]});r("temp","F");p.temp.F="";b("temp","F","C","32 - 5 9 / *");b("temp","C","K","273.15 +");b("temp","F","R","459.67 +");r("time","s");b("time","s",["seconds","second"],
1);b("time","s",["ms","millisecond","milliseconds","Millisecond","Milliseconds"],1E3);b("time","s",["m","minute","minutes","Minute","Minutes"],1/60);b("time","m",["h","hour","hours","Hour","Hours"],1/60);b("time","h",["d","day","days","Day","Days"],1/24);b("time","d",["y","year","years","Years","Year"],1/365);b("time","y",["decade","Decade","Decades","decades"],.1);b("time","decade",["century","Century","centuries","Centuries"],.1);r("mass","kg");b("mass","kg","g",1E3);w("mass","metric","g","",function(b,
c){var d=v("metric",1,b,c);return[[c+"gram","grams"],d]});c("mass","gram","g");b("mass","kg","lbs",1/.453592);b("mass","lbs","pounds pound Pound Pounds lb lbm".split(" "),1);b("mass","lbs","oz",16);b("mass","lbs",["ton","us_ton","tons"],5E-4);b("mass","kg",["tonne","metric_ton","tonnes"],.001);r("force","N");b("force","N",["Newton","newton"],1);b("force","N",["lbs","lbf","pound","Pound"],.224809);r("energy","J");b("energy","J",["Joule","joule"],1);b("energy","J",["cal","calorie","Gram-Calorie"],.239006);
b("energy","cal",["Cal","Calorie","Food-Calorie","Kilocalorie"],.001);b("energy","J",["KJ","Kilojoule","kilojoule"],.001);b("energy","J",["BTU","BritishThermalUnit"],9.47817E-4);r("cpu","byte");x("cpu","byte","B");b("cpu","B","KiB",1/1024);b("cpu","KiB","MiB",1/1024);b("cpu","MiB","GiB",1/1024);b("cpu","GiB","TiB",1/1024);b("cpu","TiB","PiB",1/1024);b("cpu","B","KB",.001);b("cpu","KB","MB",.001);b("cpu","MB","GB",.001);b("cpu","GB","TB",.001);b("cpu","TB","PB",.001);b("cpu","B","b",8);x("cpu","b",
"bit");b("cpu","b","Kib",1/1024);b("cpu","Kib","Mib",1/1024);b("cpu","Mib","Gib",1/1024);b("cpu","Gib","Tib",1/1024);b("cpu","Tib","Pib",1/1024);b("cpu","b","Kb",.001);b("cpu","Kb","Mb",.001);b("cpu","Mb","Gb",.001);b("cpu","Gb","Tb",.001);b("cpu","Tb","Pb",.001)})();this.parse=q;this.getStack=function(){return m};this.peeks=A;this.pop=f;this.peek=u;this.push=d;this.addExtension=function(b){z.push(b)}}"undefined"!==typeof module&&"undefined"!==typeof module.exports&&(module.exports=RPNParser);
