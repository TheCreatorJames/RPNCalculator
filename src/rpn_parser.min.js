function RPNParser(g,D){function q(d,b){p[d]={};p[d][b]=1}function b(d,c,f,g){if(f instanceof Array)for(var a=0;a<f.length;a++)b(d,c,f[a],g);else c=p[d][c],void 0!==c&&(p[d][f]="string"===typeof c||c instanceof String?c+g+" ":c*g)}function t(d,c,b){if(b instanceof Array)for(var f=0;f<b.length;f++)t(d,c,b[f]);else void 0!==p[d][c]&&(p[d][b]=p[d][c])}function f(d){return 0==n.length?0:(void 0===d?0:d)||!Array.isArray(x())?n.pop():n.pop()[0]}function A(){return 0==n.length?"":""+x()}function x(){return 0==
n.length?0:n[n.length-1]}function c(d){Array.isArray(d)||(d=[d]);n.push(d)}function y(d){return B[d]}function E(d){-1!=(""+d).indexOf(".")?(d=(""+d).split("."),d[0]=parseInt(d[0]),d[1]=parseInt(d[1]),d=[d[1],g.pow(10,(""+d[1]).length),d[0]]):d=[0,1,d];var c=g.gcd(d[0],d[1]);return[d[1]/c*d[2]+d[0]/c,d[1]/c]}function r(d){d=d.split(" ");for(var b="+ - / * % ^ mod".split(" "),m=0;m<d.length;m++){var k=d[m];if(0!=k.length)if(-1!=k.indexOf("..")){var a=parseInt(k.split("..")[0]),e=parseInt(k.split("..")[1]);
isNaN(a)&&(a=parseInt(""+y(k.split("..")[0])));isNaN(e)&&(e=parseInt(""+y(k.split("..")[1])));isNaN(a)||isNaN(e)||(c([a,e]),r("seq"))}else if(37==k.charCodeAt(0)&&1!=k.length)a=A(),k=k.substring(1),B[k]=a;else if(36==k.charCodeAt(0)&&1!=k.length)r(y(k.substring(1)));else{a:{var l=k;if("!"==l)c(g.factorial(f(!0)));else if("rand"==l){a=f(!0);for(e=0;e<a.length;e++)a[e]=Math.floor(1E5*Math.random()%a[e]);c(a)}else if("round"==l)c(g.round(f(!0)));else if("floor"==l)c(g.floor(f(!0)));else if("ceil"==l)c(g.ceil(f(!0)));
else if("lcm"==l)c(g.lcm(f(!0),f(!0)));else if("gcd"==l)c(g.gcd(f(!0),f(!0)));else if("pyth"==l)2==x().length&&r("mag");else if("abs"==l)c(g.abs(f(!0)));else if("min"==l||"max"==l||"lcm2"==l||"gcd2"==l){var a=f(!0),e=a[0],h=g.min;switch(l){case "max":h=g.max;break;case "lcm2":h=g.lcm;break;case "gcd2":h=g.gcd}for(l=1;l<a.length;l++)e=h(e,a[l]);c(e)}else if("ln"==l)c(g.log(f(!0)));else if("log"==l)c(g.log(f(!0))/g.log(10));else if("acc"==l)e=f(),a=f(!0),c(g.divide(g.round(g.multiply(a,g.pow(10,e))),
g.pow(10,e)));else{a=!1;break a}a=!0}if(!a)if(a=k.split("|"),3==a.length&&void 0!==p[a[0]]&&void 0!==p[a[0]][a[1]]&&void 0!==p[a[0]][a[2]]){var e=a[0],h=f(!0),l=a[1],q=a[2],v=p[e][l],a=p[e][q];if(void 0===v||void 0===a)a=0;else if(("string"===typeof v||v instanceof String)&&("string"===typeof a||a instanceof String)){for(var e=h+" ",h=v,l=" ",h=h.split(" "),v="+ - / * ^ % mod".split(" "),q="-;+;*;/;1 swap / ^;%;mod".split(";"),t=0,u="",w=0;w<h.length;w++)if(0!=h[w].length){var C=v.indexOf(h[w]);-1===
C?(t++,u+=h[w]+" "):(1==t?(l=u+q[C]+" "+l,u=""):u+=h[w]+" ",t--)}l=u+l;a=e+l+" "+a}else a=g.multiply(g.divide(h,p[e][l]),p[e][q]);"string"===typeof a||a instanceof String?r(a):c(a);a=!0}else a=!1;if(!a)a:{a=k;if("K2"==a)c(89876E5);else if("K"==a)c(1/(3.5416E-11*Math.PI));else if("Uo"==a)c(4E-7*Math.PI);else if("ec"==a||"elec"==a)c(1.602E-19);else if("electronMass"==a)c(9.10938356E-31);else if("protonMass"==a)c(1.6726E-27);else if("Eo"==a)c(8.854E-12);else if("error"==a)r("%perE del %perA del $perE $perA - $perA / 100 *");
else{a=!1;break a}a=!0}if(!a){if(a=-1!=b.indexOf(k))a:{h=k;a=f(!0);e=f(!0);if(a.length!=e.length)if(1==e.length)l=a,a=e[0],e=l;else if(1==a.length)a=a[0];else{a=!1;break a}if("+"==h)c(g.add(e,a));else if("^"==h){a=a[0];for(h=0;h<e.length;h++)e[h]=Math.pow(e[h],a);c(e)}else if("-"==h)c(g.subtract(e,a));else if("/"==h)c(g.divide(e,a));else if("*"==h)c(g.multiply(e,a));else if("%"==h||"mod"==h)c(g.mod(e,a));else{a=!1;break a}a=!0}if(!a){a:{a=k;if("asin"==a)c(g.asin(f(!0)));else if("acos"==a)c(g.acos(f(!0)));
else if("asin"==a)c(g.acos(f(!0)));else if("dcos"==a)a=f(!0),a=g.cos(g.divide(g.multiply(a,Math.PI),180)),c(a);else if("dsin"==a)a=f(!0),a=g.sin(g.divide(g.multiply(a,Math.PI),180)),c(a);else if("dtan"==a)a=f(!0),a=g.tan(g.divide(g.multiply(a,Math.PI),180)),c(a);else if("rcos"==a)a=f(!0),a=g.cos(a),c(a);else if("rsin"==a)a=f(!0),a=g.sin(a),c(a);else if("rtan"==a)a=f(!0),a=g.tan(a),c(a);else if("atan"==a)c(g.atan(f(!0)));else if("PI"==a)c(Math.PI);else if("e"==a||"E"==a)c(Math.E);else{a=!1;break a}a=
!0}if(!(a=a||F(k)))a:{a=k;if("frac"==a||"fraction"==a){a=f(!0);e=[];for(h=0;h<a.length;h++)e=e.concat(E(a[h]));c(e)}else if("seq"==a)if(a=f(!0),2<=a.length){e=1;3==a.length&&(e=a[2]);l=[];if(a[0]<a[1])for(h=a[0];h<=a[1];h+=e)l.push(h);else for(h=a[0];h>=a[1];h-=e)l.push(h);c(l)}else{a=!1;break a}else{a=!1;break a}a=!0}if(!a)a:{a=k;for(e=0;e<z.length;e++)if(z[e](a)){a=!0;break a}a=!1}if(!a)if("pop"==k||"del"==k)f();else if("@size"==k)c(n.length);else if("dup"==k)k=x(),k=JSON.parse(JSON.stringify(k)),
c(k);else if("clear"==k)k=n,n=[],delete k;else if("swap"==k)k=n[n.length-1],n[n.length-1]=n[n.length-2],n[n.length-2]=k;else{a:if(a=k,-1!=a.indexOf(",")&&0!=a.indexOf(",")){a=a.split(",");e=[];for(h=0;h<a.length;h++)if(isNaN(parseFloat(a[h]))){a=!1;break a}else e.push(parseFloat(a[h]));c(e);a=!0}else a=!1;a||(isNaN(parseFloat(k))?D(k):c(parseFloat(k)))}}}}}}function F(d){if("dot"==d)return c(g.dot(f(!0),f(!0))),!0;if("cross"==d)return c(g.cross(f(!0),f(!0))),!0;if("magnitude"==d||"mag"==d)return c(g.norm(f(!0))),
!0;if("unitVector"==d)return r("dup mag /"),!0;if("dist"==d)return c(g.distance(f(!0),f(!0))),!0;if("vecGen"==d)return r("%vecd dup dcos swap dsin 2 vec *"),!0;if("at"==d){d=f();var b=f(!0);c(b[d]);return!0}if("vecAngle"==d)return r("dup mag / dup 0 at acos deg swap 1 at asin deg"),!0;if("directionCosines"==d)return r("unitVector acos"),!0;if("directionSines"==d)return r("unitVector asin"),!0;if("multVector"==d||"divVector"==d){for(var m=f(!0),b=f(!0),k=Math.min(b.length,m.length),a=[],e=0;e<k;e++)"multVector"==
d?a.push(b[e]*m[e]):a.push(b[e]/m[e]);c(a);return!0}if("sum"==d||"product"==d){b=f(!0);for(e=m=0;e<b.length;e++)"sum"==d?m+=b[e]:(0==e&&(m=1),m*=b[e]);c(m);return!0}if("merge"==d||"union"==d||","==d)return b=f(!0),m=f(!0),c(m.concat(b)),!0;if("sort"==d)return c(g.sort(f(!0))),!0;if("uniq"==d)return c(G(f(!0))),!0;if("reverse"==d)return c(f(!0).reverse()),!0;if("mean"==d)return c(g.mean(f(!0))),!0;if("median"==d)return c(g.median(f(!0))),!0;if("mode"==d)return c(g.mode(f(!0))),!0;if("pick"==d)return c(g.pickRandom(f(!0))),
!0;if("decompose"==d){b=f(!0);for(e=0;e<b.length;e++)c(b[e]);return!0}if("std"==d)return c(g.std(f(!0))),!0;if("intersection"==d){b=f(!0);m=f(!0);a=[];for(e=0;e<b.length;e++)-1!=m.indexOf(b[e])&&(a.push(b[e]),m.splice(m.indexOf(b[e]),1));c(a);return!0}return!1}function G(b){var c={};return b.filter(function(b){return c.hasOwnProperty(b)?!1:c[b]=!0})}var p={},n=[],B={},z=[];(function(){q("dist","m");b("dist","m","meter",1);b("dist","m",["cm","centimeter"],100);b("dist","cm",["in","inch","inches"],
.3937);b("dist","in",["ft","feet"],1/12);b("dist","ft","yards",1/3);b("dist","ft",["mi","mile","miles"],1/5280);b("dist","m",["km","kilometer"],.001);b("dist","m",["mm","millimeter"],1E3);b("dist","m",["nm","nanometer"],1E9);b("dist","m",["um","micrometer"],1E6);b("dist","m",["pm","picometer"],1E12);b("dist","m",["fm","femtometer"],1E15);q("angle","rad");b("angle","rad","deg",180/Math.PI);b("angle","rad","radian",1);b("angle","deg","degree",1);b("angle","degree","degrees",1);b("angle","radian","radians",
1);q("volume","cup");b("volume","cup",["Cup","cups","Cups"],1);b("volume","cup",["tsp","teaspoon","Teaspoon","teaspoons","Teaspoons"],48);b("volume","cup",["tbsp","tablespoon","Tablespoon","tablespoons","Tablespoons"],16);b("volume","cup",["oz","floz","OZ"],8);b("volume","cup",["pint","Pint","pints","Pints"],.5);b("volume","pint",["quart","Quart","quarts","Quarts"],.5);b("volume","quart",["gallon","Gallon","gallons","Gallons"],.25);b("volume","gallon",["liter","Liter","L","l"],3.78541);b("volume",
"liter",["mL","ml"],1E3);q("temp","F");p.temp.F="";b("temp","F","C","32 - 5 9 / *");b("temp","C","K","273.15 +");b("temp","F","R","459.67 +");q("time","s");b("time","s",["seconds","second"],1);b("time","s",["ms","millisecond","milliseconds"],1E3);b("time","s",["m","minute","minutes"],1/60);b("time","m",["h","hour","hours"],1/60);b("time","h",["d","day","days"],1/24);b("time","d",["y","year","years"],1/365);q("mass","kg");b("mass","kg","g",1E3);b("mass","kg","lbs",1/.453592);b("mass","lbs","oz",16);
b("mass","lbs",["ton","us_ton","tons"],5E-4);b("mass","kg",["tonne","metric_ton","tonnes"],.001);q("cpu","byte");t("cpu","byte","B");b("cpu","B","KiB",1/1024);b("cpu","KiB","MiB",1/1024);b("cpu","MiB","GiB",1/1024);b("cpu","GiB","TiB",1/1024);b("cpu","TiB","PiB",1/1024);b("cpu","B","KB",.001);b("cpu","KB","MB",.001);b("cpu","MB","GB",.001);b("cpu","GB","TB",.001);b("cpu","TB","PB",.001);b("cpu","B","b",8);t("cpu","b","bit");b("cpu","b","Kib",1/1024);b("cpu","Kib","Mib",1/1024);b("cpu","Mib","Gib",
1/1024);b("cpu","Gib","Tib",1/1024);b("cpu","Tib","Pib",1/1024);b("cpu","b","Kb",.001);b("cpu","Kb","Mb",.001);b("cpu","Mb","Gb",.001);b("cpu","Gb","Tb",.001);b("cpu","Tb","Pb",.001);var c="exa peta tera giga mega kilo hecto deca deci centi milli micro nano pico femto atto".split(" "),f=[1E18,1E15,1E12,1E9,1E6,1E3,100,10,.1,.01,.001,1E-6,1E-9,1E-12,1E-15,1E-18];q("metric","none");for(var g=0;g<c.length;g++)b("metric","none",c[g],1/f[g]);b("metric","none","",1);b("metric","none","normal",1)})();this.parse=
r;this.getStack=function(){return n};this.peeks=A;this.pop=f;this.peek=x;this.push=c;this.addExtension=function(b){z.push(b)}}"undefined"!==typeof module&&"undefined"!==typeof module.exports&&(module.exports=RPNParser);
